<?xml version="1.0" encoding="utf-8"?>
<modification>
	<name>Filtro data e new de cliente mais export de email</name>
	<code>filtro_dados_cliente</code>
	<version>1.0</version>
	<author>Luiz Fernando Sene (nandosenne@gmail.com)</author>
	<link></link>

<file path="admin/view/template/customer/customer_list.tpl">

		<operation>
			<search><![CDATA[
					  <label class="control-label" for="input-customer-group"><?php echo $entry_customer_group; ?></label>
			]]></search>
			<add position="before" offset="1"><![CDATA[
			 <div class="form-group">
                <label class="control-label" for="input-date-added-inicio">Data Inicio</label>
                <div class="input-group date">
                  <input type="text" name="filter_date_added_inicio" value="<?php echo $filter_date_added_inicio; ?>" placeholder="Data Inicio" data-date-format="YYYY-MM-DD" 
                  id="input-date-added-inicio" class="form-control" />
                  <span class="input-group-btn">
                  <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                  </span>
				  </div>
				  
              </div>
			]]></add>
		</operation>
		
			<operation>
			<search><![CDATA[
					   <label class="control-label" for="input-approved"><?php echo $entry_approved; ?></label>
			]]></search>
			<add position="before" offset="1"><![CDATA[
			 <div class="form-group">
                <label class="control-label" for="input-date-added-fim">Data Fim</label>
                <div class="input-group date">
                  <input type="text" name="filter_date_added_fim" value="<?php echo $filter_date_added_fim; ?>" placeholder="Data Fim" data-date-format="YYYY-MM-DD" 
                  id="input-date-added-inicio" class="form-control" />
                  <span class="input-group-btn">
                  <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                  </span>
				  </div>
				  
              </div>
			]]></add>
		</operation>
		
		
			<operation>
			<search><![CDATA[
			            <label class="control-label" for="input-date-added"><?php echo $entry_date_added; ?></label>
					   
			]]></search>
			<add position="before"  offset="1"><![CDATA[
			  <div class="form-group">
                <label class="control-label" for="input-status">Newsletter</label>
                <select name="filter_news" id="input-news" class="form-control">
                  <option value="*"></option>
                  <?php if ($filter_news) { ?>
                  <option value="1" selected="selected"><?php echo $text_enabled; ?></option>
                  <?php } else { ?>
                  <option value="1"><?php echo $text_enabled; ?></option>
                  <?php } ?>
                  <?php if (!$filter_status && !is_null($filter_news)) { ?>
                  <option value="0" selected="selected"><?php echo $text_disabled; ?></option>
                  <?php } else { ?>
                  <option value="0"><?php echo $text_disabled; ?></option>
                  <?php } ?>
                </select>
              </div>
			]]></add>
		</operation>
		
		
		
			<operation>
			<search><![CDATA[
				 var filter_email = $('input[name=\'filter_email\']').val();
			]]></search>
			<add position="before"><![CDATA[
					var filter_date_added_inicio = $('input[name=\'filter_date_added_inicio\']').val();
					if (filter_date_added_inicio) {
						url += '&filter_date_added_inicio=' + encodeURIComponent(filter_date_added_inicio);
					}
					
						var filter_date_added_fim = $('input[name=\'filter_date_added_fim\']').val();
					if (filter_date_added_fim) {
						url += '&filter_date_added_fim=' + encodeURIComponent(filter_date_added_fim);
					}
					var filter_news = $('select[name=\'filter_news\']').val();
	
                	if (filter_news != '*') {
                		url += '&filter_news=' + encodeURIComponent(filter_news); 
                	}	

			]]></add>
		</operation>
		
		
				<operation>
			<search><![CDATA[
					 <td class="text-right"><?php echo $column_action; ?></td>
			]]></search>
			<add position="before"><![CDATA[
					<td class="text-right">
						<a href="javascript:void(0)">Newsletter</a>
					</td>
			]]></add>
		</operation>

		<operation>
			<search><![CDATA[
				<td class="text-left"><?php echo $customer['date_added']; ?></td>
			]]></search>
			<add position="after"><![CDATA[
						<td class="right">
							<?php echo $customer['newsletter']; ?>
						</td>
			]]></add>
		</operation>
		
		
			<operation>
			<search><![CDATA[
					<div class="pull-right"><a href="<?php echo $add; ?>" data-toggle="tooltip" title="<?php echo $button_add; ?>" class="btn btn-primary"><i class="fa fa-plus"></i></a>
			]]></search>
			<add position="after"><![CDATA[
					<div class="pull-right"><button type="button" id="button-export" class="btn btn-success pull-right"><img src="image/download.png"/></button></div>
			]]></add>
		</operation>
		
		
		
			<operation>
			<search><![CDATA[
					<?php echo $footer; ?> 
			]]></search>
			<add position="before"><![CDATA[
					<script type="text/javascript"><!--
$('#button-export').on('click', function() {
	url = 'index.php?route=customer/customer/export&token=<?php echo $token; ?>';
	
	var filter_name = $('input[name=\'filter_name\']').val();
	
	if (filter_name) {
		url += '&filter_name=' + encodeURIComponent(filter_name);
	}
	
	var filter_email = $('input[name=\'filter_email\']').val();
	
	if (filter_email) {
		url += '&filter_email=' + encodeURIComponent(filter_email);
	}
	
	var filter_customer_group_id = $('select[name=\'filter_customer_group_id\']').val();
	
	if (filter_customer_group_id != '*') {
		url += '&filter_customer_group_id=' + encodeURIComponent(filter_customer_group_id);
	}	
	
	var filter_status = $('select[name=\'filter_status\']').val();
	
	if (filter_status != '*') {
		url += '&filter_status=' + encodeURIComponent(filter_status); 
	}	
	
	var filter_approved = $('select[name=\'filter_approved\']').val();
	
	if (filter_approved != '*') {
		url += '&filter_approved=' + encodeURIComponent(filter_approved);
	}	
	
	var filter_ip = $('input[name=\'filter_ip\']').val();
	
	if (filter_ip) {
		url += '&filter_ip=' + encodeURIComponent(filter_ip);
	}
		
	var filter_date_added = $('input[name=\'filter_date_added\']').val();
	
	if (filter_date_added) {
		url += '&filter_date_added=' + encodeURIComponent(filter_date_added);
	}
	
		var filter_date_added_inicio = $('input[name=\'filter_date_added_inicio\']').val();
					if (filter_date_added_inicio) {
						url += '&filter_date_added_inicio=' + encodeURIComponent(filter_date_added_inicio);
					}
					
						var filter_date_added_fim = $('input[name=\'filter_date_added_fim\']').val();
					if (filter_date_added_fim) {
						url += '&filter_date_added_fim=' + encodeURIComponent(filter_date_added_fim);
					}
					var filter_news = $('select[name=\'filter_news\']').val();
	
                	if (filter_news != '*') {
                		url += '&filter_news=' + encodeURIComponent(filter_news); 
                	}	
	
	location = url;
});
//--></script> 
			]]></add>
		</operation>
		
		
		
		
		
		
	
		

	
	
	
		
	</file>
	
	
	
	
	
	<file path="admin/controller/customer/customer.php">

	
				<operation>
			<search><![CDATA[
					public function index() {
			]]></search>
			<add position="before"><![CDATA[
							public function export() {
                            		$this->load->language('customer/customer');
                            
                            		$this->document->setTitle($this->language->get('heading_title'));
                            
                            		$this->load->model('customer/customer');
                            
                            		$this->getExport();
                            	}
			]]></add>
		</operation>


		<operation>
			<search><![CDATA[
				protected function getList() {
			]]></search>
			<add position="after"><![CDATA[
					if (isset($this->request->get['filter_date_added_inicio'])) {
						$filter_date_added_inicio = $this->request->get['filter_date_added_inicio'];
					} else {
						$filter_date_added_inicio = null;
					}
					if (isset($this->request->get['filter_news'])) {
            			$filter_news = $this->request->get['filter_news'];
            		} else {
            			$filter_news = null;
            		}
			]]></add>
		</operation>

		<operation>
			<search><![CDATA[
				'filter_email'             => $filter_email,
			]]></search>
			<add position="after"><![CDATA[
					'filter_date_added_inicio'	   => $filter_date_added_inicio,
					'filter_news'	   => $filter_news,
			]]></add>
		</operation>

		<operation>
			<search><![CDATA[
				$url .= '&filter_email=' . urlencode(html_entity_decode($this->request->get['filter_email'], ENT_QUOTES, 'UTF-8'));
			]]></search>
			<add position="after" offset='1'><![CDATA[
					if (isset($this->request->get['filter_date_added_inicio'])) {
						$url .= '&filter_date_added_inicio=' . $this->request->get['filter_date_added_inicio'];
					}
					if (isset($this->request->get['filter_news'])) {
						$url .= '&filter_news=' . $this->request->get['filter_news'];
					}
			]]></add>
		</operation>
		
		<operation>
			<search><![CDATA[
				$data['filter_name'] = $filter_name;
			]]></search>
			<add position="after" offset='1'><![CDATA[
					$data['filter_date_added_inicio'] = $filter_date_added_inicio;
					$data['filter_news'] = $filter_news;
			]]></add>
		</operation>
		
		
		
		
			<operation>
			<search><![CDATA[
				protected function getList() {
			]]></search>
			<add position="after"><![CDATA[
					if (isset($this->request->get['filter_date_added_fim'])) {
						$filter_date_added_fim = $this->request->get['filter_date_added_fim'];
					} else {
						$filter_date_added_fim = null;
					}
			]]></add>
		</operation>

		<operation>
			<search><![CDATA[
				'filter_email'             => $filter_email,
			]]></search>
			<add position="after"><![CDATA[
					'filter_date_added_fim'	   => $filter_date_added_fim,
			]]></add>
		</operation>

		<operation>
			<search><![CDATA[
				$url .= '&filter_email=' . urlencode(html_entity_decode($this->request->get['filter_email'], ENT_QUOTES, 'UTF-8'));
			]]></search>
			<add position="after" offset='1'><![CDATA[
					if (isset($this->request->get['filter_date_added_fim'])) {
						$url .= '&filter_date_added_inicio=' . $this->request->get['filter_date_added_fim'];
					}
			]]></add>
		</operation>
		
		<operation>
			<search><![CDATA[
				$data['filter_name'] = $filter_name;
			]]></search>
			<add position="after" offset='1'><![CDATA[
					$data['filter_date_added_fim'] = $filter_date_added_fim;
			]]></add>
		</operation>
		
		
		
			<operation>
			<search><![CDATA[
			'email'          => $result['email'],
			]]></search>
			<add position="before"><![CDATA[
				'newsletter'      => $result['newsletter'] ? 'Sim' : 'Não',
			]]></add>
		</operation>	
		
		
		
		
					<operation>
			<search><![CDATA[
					protected function getList() {
			]]></search>
			<add position="before"><![CDATA[
						protected function getExport() {

					if (isset($this->request->get['filter_date_added_fim'])) {
						$filter_date_added_fim = $this->request->get['filter_date_added_fim'];
					} else {
						$filter_date_added_fim = null;
					}
			

					if (isset($this->request->get['filter_date_added_inicio'])) {
						$filter_date_added_inicio = $this->request->get['filter_date_added_inicio'];
					} else {
						$filter_date_added_inicio = null;
					}
					if (isset($this->request->get['filter_news'])) {
            			$filter_news = $this->request->get['filter_news'];
            		} else {
            			$filter_news = null;
            		}
			

					if (isset($this->request->get['filter_cpf'])) {
						$filter_cpf = $this->request->get['filter_cpf'];
					} else {
						$filter_cpf = null;
					}
			
		if (isset($this->request->get['filter_name'])) {
			$filter_name = $this->request->get['filter_name'];
		} else {
			$filter_name = null;
		}

		if (isset($this->request->get['filter_email'])) {
			$filter_email = $this->request->get['filter_email'];
		} else {
			$filter_email = null;
		}

		if (isset($this->request->get['filter_customer_group_id'])) {
			$filter_customer_group_id = $this->request->get['filter_customer_group_id'];
		} else {
			$filter_customer_group_id = null;
		}

		if (isset($this->request->get['filter_status'])) {
			$filter_status = $this->request->get['filter_status'];
		} else {
			$filter_status = null;
		}

		if (isset($this->request->get['filter_approved'])) {
			$filter_approved = $this->request->get['filter_approved'];
		} else {
			$filter_approved = null;
		}

		if (isset($this->request->get['filter_ip'])) {
			$filter_ip = $this->request->get['filter_ip'];
		} else {
			$filter_ip = null;
		}

		if (isset($this->request->get['filter_date_added'])) {
			$filter_date_added = $this->request->get['filter_date_added'];
		} else {
			$filter_date_added = null;
		}

		if (isset($this->request->get['sort'])) {
			$sort = $this->request->get['sort'];
		} else {
			$sort = 'name';
		}

		if (isset($this->request->get['order'])) {
			$order = $this->request->get['order'];
		} else {
			$order = 'ASC';
		}

		if (isset($this->request->get['page'])) {
			$page = $this->request->get['page'];
		} else {
			$page = 1;
		}

		$url = '';

		if (isset($this->request->get['filter_name'])) {
			$url .= '&filter_name=' . urlencode(html_entity_decode($this->request->get['filter_name'], ENT_QUOTES, 'UTF-8'));
		}

		if (isset($this->request->get['filter_email'])) {
			$url .= '&filter_email=' . urlencode(html_entity_decode($this->request->get['filter_email'], ENT_QUOTES, 'UTF-8'));
		}

					if (isset($this->request->get['filter_date_added_fim'])) {
						$url .= '&filter_date_added_inicio=' . $this->request->get['filter_date_added_fim'];
					}
			

					if (isset($this->request->get['filter_date_added_inicio'])) {
						$url .= '&filter_date_added_inicio=' . $this->request->get['filter_date_added_inicio'];
					}
					if (isset($this->request->get['filter_news'])) {
						$url .= '&filter_news=' . $this->request->get['filter_news'];
					}
			

					if (isset($this->request->get['filter_cpf'])) {
						$url .= '&filter_cpf=' . $this->request->get['filter_cpf'];
					}
			

		if (isset($this->request->get['filter_customer_group_id'])) {
			$url .= '&filter_customer_group_id=' . $this->request->get['filter_customer_group_id'];
		}

		if (isset($this->request->get['filter_status'])) {
			$url .= '&filter_status=' . $this->request->get['filter_status'];
		}

		if (isset($this->request->get['filter_approved'])) {
			$url .= '&filter_approved=' . $this->request->get['filter_approved'];
		}

		if (isset($this->request->get['filter_ip'])) {
			$url .= '&filter_ip=' . $this->request->get['filter_ip'];
		}

		if (isset($this->request->get['filter_date_added'])) {
			$url .= '&filter_date_added=' . $this->request->get['filter_date_added'];
		}

		if (isset($this->request->get['sort'])) {
			$url .= '&sort=' . $this->request->get['sort'];
		}

		if (isset($this->request->get['order'])) {
			$url .= '&order=' . $this->request->get['order'];
		}

		if (isset($this->request->get['page'])) {
			$url .= '&page=' . $this->request->get['page'];
		}

		$data['breadcrumbs'] = array();

		$data['breadcrumbs'][] = array(
			'text' => $this->language->get('text_home'),
			'href' => $this->url->link('common/dashboard', 'token=' . $this->session->data['token'], true)
		);

		$data['breadcrumbs'][] = array(
			'text' => $this->language->get('heading_title'),
			'href' => $this->url->link('customer/customer', 'token=' . $this->session->data['token'] . $url, true)
		);

		$data['add'] = $this->url->link('customer/customer/add', 'token=' . $this->session->data['token'] . $url, true);
		$data['delete'] = $this->url->link('customer/customer/delete', 'token=' . $this->session->data['token'] . $url, true);

		$data['customers'] = array();

		$filter_data = array(
			'filter_name'              => $filter_name,
			'filter_email'             => $filter_email,

					'filter_date_added_fim'	   => $filter_date_added_fim,
			

					'filter_date_added_inicio'	   => $filter_date_added_inicio,
					'filter_news'	   => $filter_news,
			

					'filter_cpf'	   => $filter_cpf,
			
			'filter_customer_group_id' => $filter_customer_group_id,
			'filter_status'            => $filter_status,
			'filter_approved'          => $filter_approved,
			'filter_date_added'        => $filter_date_added,
			'filter_ip'                => $filter_ip,
			'sort'                     => $sort,
			'order'                    => $order,
			'start'                    => ($page - 1) * 1000000000000,
			'limit'                    => 1000000000000
		);

		$customer_total = $this->model_customer_customer->getTotalCustomers($filter_data);

		$results = $this->model_customer_customer->getCustomers($filter_data);

		foreach ($results as $result) {
			if (!$result['approved']) {
				$approve = $this->url->link('customer/customer/approve', 'token=' . $this->session->data['token'] . '&customer_id=' . $result['customer_id'] . $url, true);
			} else {
				$approve = '';
			}

			$login_info = $this->model_customer_customer->getTotalLoginAttempts($result['email']);


					$custom_cpf='';
				if($result['custom_field'] && !empty($result['custom_field'])){
									foreach(json_decode($result['custom_field']) as $chave => $valor){
										if($chave == '1'){
											$custom_cpf = preg_replace("/[^0-9]/", "",trim($valor));
										}
									}
								}
			
			if ($login_info && $login_info['total'] >= $this->config->get('config_login_attempts')) {
				$unlock = $this->url->link('customer/customer/unlock', 'token=' . $this->session->data['token'] . '&email=' . $result['email'] . $url, true);
			} else {
				$unlock = '';
			}

			$data['customers'][] = array(
				'customer_id'    => $result['customer_id'],
				'name'           => $result['name'],

				'custom_cpf'      => $custom_cpf,
			

				'newsletter'      => $result['newsletter'] ? 'Sim' : 'Não',
			
				'email'          => $result['email'],
				'customer_group' => $result['customer_group'],
				'status'         => ($result['status'] ? $this->language->get('text_enabled') : $this->language->get('text_disabled')),
				'ip'             => $result['ip'],
				'date_added'     => date($this->language->get('date_format_short'), strtotime($result['date_added'])),
				'approve'        => $approve,
				'unlock'         => $unlock,
				'edit'           => $this->url->link('customer/customer/edit', 'token=' . $this->session->data['token'] . '&customer_id=' . $result['customer_id'] . $url, true)
			);
		}

		$data['heading_title'] = $this->language->get('heading_title');

		$data['text_list'] = $this->language->get('text_list');
		$data['text_enabled'] = $this->language->get('text_enabled');
		$data['text_disabled'] = $this->language->get('text_disabled');
		$data['text_yes'] = $this->language->get('text_yes');
		$data['text_no'] = $this->language->get('text_no');
		$data['text_default'] = $this->language->get('text_default');
		$data['text_no_results'] = $this->language->get('text_no_results');
		$data['text_confirm'] = $this->language->get('text_confirm');

		$data['column_name'] = $this->language->get('column_name');
		$data['column_email'] = $this->language->get('column_email');
		$data['column_customer_group'] = $this->language->get('column_customer_group');
		$data['column_status'] = $this->language->get('column_status');
		$data['column_approved'] = $this->language->get('column_approved');
		$data['column_ip'] = $this->language->get('column_ip');
		$data['column_date_added'] = $this->language->get('column_date_added');
		$data['column_action'] = $this->language->get('column_action');

		$data['entry_name'] = $this->language->get('entry_name');
		$data['entry_email'] = $this->language->get('entry_email');
		$data['entry_customer_group'] = $this->language->get('entry_customer_group');
		$data['entry_status'] = $this->language->get('entry_status');
		$data['entry_approved'] = $this->language->get('entry_approved');
		$data['entry_ip'] = $this->language->get('entry_ip');
		$data['entry_date_added'] = $this->language->get('entry_date_added');

		$data['button_approve'] = $this->language->get('button_approve');
		$data['button_add'] = $this->language->get('button_add');
		$data['button_edit'] = $this->language->get('button_edit');
		$data['button_delete'] = $this->language->get('button_delete');
		$data['button_filter'] = $this->language->get('button_filter');
		$data['button_login'] = $this->language->get('button_login');
		$data['button_unlock'] = $this->language->get('button_unlock');

		$data['token'] = $this->session->data['token'];

		if (isset($this->error['warning'])) {
			$data['error_warning'] = $this->error['warning'];
		} else {
			$data['error_warning'] = '';
		}

		if (isset($this->session->data['success'])) {
			$data['success'] = $this->session->data['success'];

			unset($this->session->data['success']);
		} else {
			$data['success'] = '';
		}

		if (isset($this->request->post['selected'])) {
			$data['selected'] = (array)$this->request->post['selected'];
		} else {
			$data['selected'] = array();
		}

		$url = '';

		if (isset($this->request->get['filter_name'])) {
			$url .= '&filter_name=' . urlencode(html_entity_decode($this->request->get['filter_name'], ENT_QUOTES, 'UTF-8'));
		}

		if (isset($this->request->get['filter_email'])) {
			$url .= '&filter_email=' . urlencode(html_entity_decode($this->request->get['filter_email'], ENT_QUOTES, 'UTF-8'));
		}

					if (isset($this->request->get['filter_date_added_fim'])) {
						$url .= '&filter_date_added_inicio=' . $this->request->get['filter_date_added_fim'];
					}
			

					if (isset($this->request->get['filter_date_added_inicio'])) {
						$url .= '&filter_date_added_inicio=' . $this->request->get['filter_date_added_inicio'];
					}
					if (isset($this->request->get['filter_news'])) {
						$url .= '&filter_news=' . $this->request->get['filter_news'];
					}
			

					if (isset($this->request->get['filter_cpf'])) {
						$url .= '&filter_cpf=' . $this->request->get['filter_cpf'];
					}
			

		if (isset($this->request->get['filter_customer_group_id'])) {
			$url .= '&filter_customer_group_id=' . $this->request->get['filter_customer_group_id'];
		}

		if (isset($this->request->get['filter_status'])) {
			$url .= '&filter_status=' . $this->request->get['filter_status'];
		}

		if (isset($this->request->get['filter_approved'])) {
			$url .= '&filter_approved=' . $this->request->get['filter_approved'];
		}

		if (isset($this->request->get['filter_ip'])) {
			$url .= '&filter_ip=' . $this->request->get['filter_ip'];
		}

		if (isset($this->request->get['filter_date_added'])) {
			$url .= '&filter_date_added=' . $this->request->get['filter_date_added'];
		}

		if ($order == 'ASC') {
			$url .= '&order=DESC';
		} else {
			$url .= '&order=ASC';
		}

		if (isset($this->request->get['page'])) {
			$url .= '&page=' . $this->request->get['page'];
		}

		$data['sort_name'] = $this->url->link('customer/customer', 'token=' . $this->session->data['token'] . '&sort=name' . $url, true);
		$data['sort_email'] = $this->url->link('customer/customer', 'token=' . $this->session->data['token'] . '&sort=c.email' . $url, true);
		$data['sort_customer_group'] = $this->url->link('customer/customer', 'token=' . $this->session->data['token'] . '&sort=customer_group' . $url, true);
		$data['sort_status'] = $this->url->link('customer/customer', 'token=' . $this->session->data['token'] . '&sort=c.status' . $url, true);
		$data['sort_ip'] = $this->url->link('customer/customer', 'token=' . $this->session->data['token'] . '&sort=c.ip' . $url, true);
		$data['sort_date_added'] = $this->url->link('customer/customer', 'token=' . $this->session->data['token'] . '&sort=c.date_added' . $url, true);

		$url = '';

		if (isset($this->request->get['filter_name'])) {
			$url .= '&filter_name=' . urlencode(html_entity_decode($this->request->get['filter_name'], ENT_QUOTES, 'UTF-8'));
		}

		if (isset($this->request->get['filter_email'])) {
			$url .= '&filter_email=' . urlencode(html_entity_decode($this->request->get['filter_email'], ENT_QUOTES, 'UTF-8'));
		}

					if (isset($this->request->get['filter_date_added_fim'])) {
						$url .= '&filter_date_added_inicio=' . $this->request->get['filter_date_added_fim'];
					}
			

					if (isset($this->request->get['filter_date_added_inicio'])) {
						$url .= '&filter_date_added_inicio=' . $this->request->get['filter_date_added_inicio'];
					}
					if (isset($this->request->get['filter_news'])) {
						$url .= '&filter_news=' . $this->request->get['filter_news'];
					}
			

					if (isset($this->request->get['filter_cpf'])) {
						$url .= '&filter_cpf=' . $this->request->get['filter_cpf'];
					}
			

		if (isset($this->request->get['filter_customer_group_id'])) {
			$url .= '&filter_customer_group_id=' . $this->request->get['filter_customer_group_id'];
		}

		if (isset($this->request->get['filter_status'])) {
			$url .= '&filter_status=' . $this->request->get['filter_status'];
		}

		if (isset($this->request->get['filter_approved'])) {
			$url .= '&filter_approved=' . $this->request->get['filter_approved'];
		}

		if (isset($this->request->get['filter_ip'])) {
			$url .= '&filter_ip=' . $this->request->get['filter_ip'];
		}

		if (isset($this->request->get['filter_date_added'])) {
			$url .= '&filter_date_added=' . $this->request->get['filter_date_added'];
		}

		if (isset($this->request->get['sort'])) {
			$url .= '&sort=' . $this->request->get['sort'];
		}

		if (isset($this->request->get['order'])) {
			$url .= '&order=' . $this->request->get['order'];
		}

		$pagination = new Pagination();
		$pagination->total = $customer_total;
		$pagination->page = $page;
		$pagination->limit = $this->config->get('config_limit_admin');
		$pagination->url = $this->url->link('customer/customer', 'token=' . $this->session->data['token'] . $url . '&page={page}', true);

		$data['pagination'] = $pagination->render();

		$data['results'] = sprintf($this->language->get('text_pagination'), ($customer_total) ? (($page - 1) * $this->config->get('config_limit_admin')) + 1 : 0, ((($page - 1) * $this->config->get('config_limit_admin')) > ($customer_total - $this->config->get('config_limit_admin'))) ? $customer_total : ((($page - 1) * $this->config->get('config_limit_admin')) + $this->config->get('config_limit_admin')), $customer_total, ceil($customer_total / $this->config->get('config_limit_admin')));

		$data['filter_name'] = $filter_name;
		$data['filter_email'] = $filter_email;

					$data['filter_date_added_fim'] = $filter_date_added_fim;
			

					$data['filter_date_added_inicio'] = $filter_date_added_inicio;
					$data['filter_news'] = $filter_news;
			

					$data['filter_cpf'] = $filter_cpf;
			
		$data['filter_customer_group_id'] = $filter_customer_group_id;
		$data['filter_status'] = $filter_status;
		$data['filter_approved'] = $filter_approved;
		$data['filter_ip'] = $filter_ip;
		$data['filter_date_added'] = $filter_date_added;

		$this->load->model('customer/customer_group');

		$data['customer_groups'] = $this->model_customer_customer_group->getCustomerGroups();

		$this->load->model('setting/store');

		$data['stores'] = $this->model_setting_store->getStores();

		$data['sort'] = $sort;
		$data['order'] = $order;

		$data['header'] = $this->load->controller('common/header');
		$data['column_left'] = $this->load->controller('common/column_left');
		$data['footer'] = $this->load->controller('common/footer');

		$this->response->setOutput($this->load->view('customer/customer_export', $data));
	}
			]]></add>
		</operation>


	</file>		
	

	<file path="admin/model/customer/customer.php">
	
		
		<operation>
			<search><![CDATA[
					$implode[] = "c.email LIKE '" . $this->db->escape($data['filter_email']) . "%'";
			]]></search>
			<add position="before" offset='1'><![CDATA[
					if (!empty($data['filter_date_added_inicio'])) {
            			$implode[] = "DATE(c.date_added) >= DATE('" . $this->db->escape($data['filter_date_added_inicio']) . "')";
            		}
            		if (!empty($data['filter_date_added_fim'])) {
            			$implode[] = "DATE(c.date_added) <= DATE('" . $this->db->escape($data['filter_date_added_fim']) . "')";
            		}
            		
            		if (isset($data['filter_news']) && !is_null($data['filter_news'])) {
                			$implode[] = "c.approved = '" . (int)$data['filter_news'] . "'";
                	}
			]]></add>
		</operation>
		
		<operation>
			<search><![CDATA[
					$implode[] = "email LIKE '" . $this->db->escape($data['filter_email']) . "%'";
			]]></search>
			<add position="before" offset='1'><![CDATA[

					if (!empty($data['filter_date_added_inicio'])) {
            			$implode[] = "DATE(date_added) >= DATE('" . $this->db->escape($data['filter_date_added_inicio']) . "')";
            		}
            			if (!empty($data['filter_date_added_fim'])) {
            			$implode[] = "DATE(date_added) <= DATE('" . $this->db->escape($data['filter_date_added_fim']) . "')";
            		}
            		if (isset($data['filter_news']) && !is_null($data['filter_news'])) {
                			$implode[] = "approved = '" . (int)$data['filter_news'] . "'";
                	}
					
			]]></add>
		</operation>
		
		
	
	
		
	</file>	
	
	</modification>